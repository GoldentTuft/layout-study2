module Main exposing (main)

import Browser
import Html exposing (Html)
import Html.Attributes.Classname exposing (classMixinWith)
import Mixin exposing (Mixin)
import Mixin.Html as Mixin
import Neat exposing (NoGap, Protected, Renderer, View, defaultRenderer, fromNoGap, setAttribute, setBoundary, setLayout, setMixin, setMixins)
import Neat.Layout as Layout
import Neat.Layout.Column as Column exposing (Column, defaultColumn)
import Neat.Layout.Row as Row exposing (defaultRow)



-- App


main : Program () Model Msg
main =
    Neat.element
        { init = \_ -> init
        , view = view
        , update = update
        , subscriptions = subscriptions
        , renderer = \_ -> defaultRenderer
        }


type alias Model =
    ()


init : ( Model, Cmd Msg )
init =
    ( ()
    , Cmd.none
    )


type Msg
    = NoOp


update : Msg -> Model -> ( Model, Cmd Msg )
update msg model =
    case msg of
        NoOp ->
            ( model
            , Cmd.none
            )


type MenuGap
    = MenuGap


menuGap : Neat.IsGap MenuGap
menuGap =
    Neat.IsGap
        { width = 0.8
        , height = 0.8
        }


menu : View NoGap msg
menu =
    Layout.row
        [ Neat.textBlock "Brand"
            |> setClass "menu_brand"
            |> fromNoGap menuGap
        , Layout.rowWith { defaultRow | horizontal = Row.Right, vertical = Row.VCenter }
            [ menuItem "Item2"
            , menuItem "Item3"
            , Layout.column
                [ Neat.textBlock "Item444444"
                , Layout.columnWith { defaultColumn | horizontal = Column.Right }
                    [ Layout.column
                        [ Neat.textBlock "menu1"
                            |> setClass "dropDown_item"
                        , Neat.textBlock "menu22222222222222222"
                            |> setClass "dropDown_item"
                        ]
                    ]
                    |> setClass "dropDown_items"
                ]
                |> setClass "dropDown"
                |> fromNoGap menuGap
            , menuItem "Item5"
            ]
            |> setLayout Layout.fill
        ]
        |> setBoundary menuGap
        |> setClass "menu"


menuItem : String -> View MenuGap msg
menuItem m =
    Neat.textBlock
        m
        |> setClass "menu_item"
        |> fromNoGap menuGap


type BodyGap
    = BodyGap


bodyGap : Neat.IsGap BodyGap
bodyGap =
    Neat.IsGap
        { width = 0.8
        , height = 0.8
        }


box : View NoGap msg
box =
    Neat.textBlock """
        Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
        """


body : View NoGap msg
body =
    Layout.row
        [ Neat.textBlock "leftSide"
            |> fromNoGap bodyGap
            |> setBoundary bodyGap
            |> setLayout (Layout.fillBy 15)
            |> setClass "sidebar"
        , Layout.column
            [ Neat.textBlock "content"
            , Neat.textBlock "hoge"
            , Neat.textBlock "piyo"
            , Layout.column (List.repeat 100 box)
            ]
            |> setLayout Layout.fill
            |> setClass "scrollAreaY"
            |> fromNoGap bodyGap
            |> setBoundary bodyGap
            |> setLayout (Layout.fillBy 70)
            |> setClass "content"
        , Neat.textBlock "rightSide"
            |> fromNoGap bodyGap
            |> setBoundary bodyGap
            |> setLayout (Layout.fillBy 15)
            |> setClass "sidebar"
        ]
        |> setClass "body"


type TabGap
    = TabGap


tabGap : Neat.IsGap TabGap
tabGap =
    Neat.IsGap
        { width = 0
        , height = 0.8
        }


tab =
    Layout.column
        [ Neat.empty
            |> fromNoGap tabGap
            |> setBoundary tabGap
        , Layout.rowWith { defaultRow | vertical = Row.Bottom }
            [ tabItem "tab123456789abcdefg" False
            , tabItem "tab2" True
            , tabItem "tab3" False
            , tabItem "tab4abcdefg" False
            , tabItem "tab5abcdefg" False
            ]
            |> setClass "tab"
        ]


tabItem : String -> Bool -> View NoGap msg
tabItem label sel =
    Neat.textBlock label
        |> (if sel then
                setClass "tab_item__sel"

            else
                setClass "tab_item"
           )


view : Model -> View NoGap Msg
view model =
    Layout.column
        [ menu
        , tab
        , body |> setLayout Layout.fill
        , Neat.textBlock "footer"
            |> setClass "footer"
        ]
        |> setClass "main"


subscriptions : Model -> Sub Msg
subscriptions _ =
    Sub.none



-- Helper functions


{-| A specialized version of `class` for this module.
It converts given class names into ones generated by CSS modules.
-}
class : String -> Mixin msg
class =
    classMixinWith <| \name -> "app__" ++ name


setClass : String -> View NoGap msg -> View NoGap msg
setClass =
    setMixin << class
